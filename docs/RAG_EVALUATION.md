# RAG ä¸Šä¸‹æ–‡æ„ŸçŸ¥è¯„ä¼°æŠ¥å‘Š - å‰ç«¯é¢è¯•è§†è§’

## ğŸ“Š æ€»ä½“è¯„åˆ†ï¼š**7.5/10** (é¡¹ç›®çº§å®ç°ï¼Œé€‚åˆå‰ç«¯é¢è¯•å±•ç¤º)

---

## ğŸ¯ ä¸€ã€æ ¸å¿ƒæ¶æ„è¯„ä¼°

### âœ… 1.1 RAG å®ç°å®Œæ•´æ€§ (8/10)

**ä¼˜ç‚¹ï¼š**

- âœ… **å®Œæ•´çš„ RAG æµç¨‹**ï¼šå®ç°äº†ç´¢å¼•æ„å»º â†’ æ£€ç´¢ â†’ å¢å¼ºç”Ÿæˆçš„å®Œæ•´é“¾è·¯
- âœ… **è¯­ä¹‰åˆ†å—ç­–ç•¥**ï¼šåŸºäº Markdown æ ‡é¢˜çš„æ™ºèƒ½åˆ†å—ï¼Œä¿æŒæ®µè½å®Œæ•´æ€§
- âœ… **å‘é‡æ£€ç´¢**ï¼šä½¿ç”¨é€šä¹‰åƒé—® Embedding API + ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—
- âœ… **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒæ‰¹é‡ embedding ç”Ÿæˆï¼Œæå‡æ€§èƒ½
- âœ… **ç¼“å­˜æœºåˆ¶**ï¼šembedding ç»“æœç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—

**ä»£ç ç¤ºä¾‹ï¼š**

```typescript
// src/utils/qwenRAGService.ts#46-91
async buildIndex(markdown: string): Promise<void> {
  // 1. è¯­ä¹‰åˆ†å—
  const rawChunks = this.semanticChunk(markdown);

  // 2. æ‰¹é‡ç”Ÿæˆembedding
  const BATCH_SIZE = 10;
  for (let i = 0; i < rawChunks.length; i += BATCH_SIZE) {
    const embeddings = await this.batchGetEmbeddings(texts);
    // å­˜å‚¨å‘é‡å’Œå…ƒæ•°æ®
  }
}
```

**ä¸è¶³ï¼š**

- âš ï¸ ç¼ºå°‘æŒä¹…åŒ–å­˜å‚¨ï¼ˆä»…å†…å­˜å­˜å‚¨ï¼Œåˆ·æ–°é¡µé¢åç´¢å¼•ä¸¢å¤±ï¼‰
- âš ï¸ æœªå®ç°å¢é‡æ›´æ–°ï¼ˆæ–‡æ¡£ä¿®æ”¹åéœ€è¦å®Œå…¨é‡å»ºç´¢å¼•ï¼‰

---

### âœ… 1.2 ä¸Šä¸‹æ–‡æ„ŸçŸ¥æœºåˆ¶ (7.5/10)

#### **å¤šç»´åº¦ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼š**

**1. æ–‡æ¡£ç±»å‹æ„ŸçŸ¥ (8/10)**

````typescript
// src/utils/qwenRAGService.ts#23-32
function detectDocTypeForRAG(text: string): 'code' | 'technical' | 'literary' {
  const codeSignals = /```|function\s|\bclass\b|<\w+>|=>|import\s/;
  const technicalSignals = /\bAPI\b|\bHTTP\b|é…ç½®|ç®—æ³•|å‚æ•°|è¿”å›å€¼/;
  // æ ¹æ®æ–‡æ¡£ç±»å‹è°ƒæ•´ç”Ÿæˆç­–ç•¥
}
````

**ä¼˜ç‚¹ï¼š**

- âœ… è‡ªåŠ¨è¯†åˆ«ä»£ç /æŠ€æœ¯æ–‡æ¡£/æ–‡å­¦æ–‡æœ¬
- âœ… åŠ¨æ€è°ƒæ•´ temperature å‚æ•°ï¼ˆä»£ç  0.2ï¼ŒæŠ€æœ¯ 0.3ï¼Œæ–‡å­¦ 0.8ï¼‰
- âœ… æ³¨å…¥ä¸åŒçš„ Style Guide æç¤ºè¯

**2. ä½ç½®ä¸Šä¸‹æ–‡æ„ŸçŸ¥ (7/10)**

```typescript
// src/utils/qwenRAGService.ts#156-161
const query = `${prefix.slice(-200)} ${suffix.slice(0, 100)}`.trim();
const results = await this.search(query, topK);
```

**ä¼˜ç‚¹ï¼š**

- âœ… ç»“åˆå…‰æ ‡å‰åæ–‡æœ¬æ„å»ºæŸ¥è¯¢
- âœ… æ£€ç´¢ç›¸å…³æ®µè½ä½œä¸ºè¯æ®

**ä¸è¶³ï¼š**

- âš ï¸ å‰åæ–‡æˆªå–é•¿åº¦å›ºå®šï¼ˆ200/100å­—ç¬¦ï¼‰ï¼Œæœªæ ¹æ®æ–‡æ¡£ç±»å‹åŠ¨æ€è°ƒæ•´
- âš ï¸ æœªè€ƒè™‘å½“å‰ç« èŠ‚/æ ‡é¢˜å±‚çº§ä¿¡æ¯

**3. å†å²ä¸Šä¸‹æ–‡æ„ŸçŸ¥ (6/10)**

```typescript
// src/utils/qwenRAGService.ts#327-387
private async searchHistoryLocal(query: string, topK: number, minSim: number) {
  const raw = localStorage.getItem('wisdom_ark_history_docs');
  // ä»å†å²æ–‡æ¡£ä¸­æ£€ç´¢ç›¸å…³ç‰‡æ®µ
}
```

**ä¼˜ç‚¹ï¼š**

- âœ… æ”¯æŒè·¨æ–‡æ¡£å†å²æ£€ç´¢
- âœ… ä½¿ç”¨ localStorage è½»é‡çº§å­˜å‚¨

**ä¸è¶³ï¼š**

- âš ï¸ å†å²æ£€ç´¢å¤±è´¥æ—¶é™é»˜å¿½ç•¥ï¼ˆæ— é™çº§ç­–ç•¥ï¼‰
- âš ï¸ æœªå®ç°å†å²æ–‡æ¡£çš„æ—¶é—´è¡°å‡æƒé‡
- âš ï¸ localStorage å®¹é‡é™åˆ¶ï¼ˆé€šå¸¸ 5-10MBï¼‰

**4. å…ƒæ•°æ®ä¸Šä¸‹æ–‡ (7/10)**

```typescript
// src/utils/qwenRAGService.ts#392-453
metadata: {
  chapter: string; // ç« èŠ‚æ ‡é¢˜
  level: number; // æ ‡é¢˜å±‚çº§
  position: number; // å—ä½ç½®
}
```

**ä¼˜ç‚¹ï¼š**

- âœ… ä¿ç•™ç« èŠ‚ç»“æ„ä¿¡æ¯
- âœ… æ£€ç´¢ç»“æœå±•ç¤ºç« èŠ‚æ¥æº

**ä¸è¶³ï¼š**

- âš ï¸ æœªåˆ©ç”¨å…ƒæ•°æ®è¿›è¡ŒåŠ æƒï¼ˆå¦‚ä¼˜å…ˆæ£€ç´¢åŒç« èŠ‚å†…å®¹ï¼‰
- âš ï¸ ç¼ºå°‘æ—¶é—´æˆ³ã€ä½œè€…ç­‰æ‰©å±•å…ƒæ•°æ®

---

### âœ… 1.3 æ£€ç´¢è´¨é‡ (7/10)

**ç›¸ä¼¼åº¦è®¡ç®—ï¼š**

```typescript
// src/utils/qwenRAGService.ts#458-475
private cosineSimilarity(vecA: number[], vecB: number[]): number {
  // æ ‡å‡†ä½™å¼¦ç›¸ä¼¼åº¦å®ç°
  return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));
}
```

**ä¼˜ç‚¹ï¼š**

- âœ… ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆRAG æ ‡å‡†åšæ³•ï¼‰
- âœ… è®¾ç½®æœ€å°ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆ0.2ï¼‰è¿‡æ»¤ä½è´¨é‡ç»“æœ
- âœ… Top-K æ’åºè¿”å›æœ€ç›¸å…³ç»“æœ

**ä¸è¶³ï¼š**

- âš ï¸ æœªå®ç°æ··åˆæ£€ç´¢ï¼ˆå‘é‡æ£€ç´¢ + å…³é”®è¯æ£€ç´¢ï¼‰
- âš ï¸ ç¼ºå°‘é‡æ’åºï¼ˆRerankingï¼‰æœºåˆ¶
- âš ï¸ æœªè€ƒè™‘å¤šæ ·æ€§ï¼ˆå¯èƒ½è¿”å›é‡å¤å†…å®¹ï¼‰

---

### âœ… 1.4 ç”Ÿæˆå¢å¼ºç­–ç•¥ (8/10)

**è¯æ®æ³¨å…¥ï¼š**

```typescript
// src/utils/qwenRAGService.ts#184-206
const evidence = finalResults
  .map((r, idx) => {
    const title = `#${idx + 1} ${r.metadata.chapter}`;
    const snippet = r.content.slice(0, 200);
    return `${title} (${(r.score * 100).toFixed(0)}%)\n${snippet}`;
  })
  .join('\n\n');

const injectedPrefix = `${styleGuide}\n${evidence}\n\n${prefix.slice(-500)}`;
```

**ä¼˜ç‚¹ï¼š**

- âœ… ç»“æ„åŒ–è¯æ®æ‘˜è¦ï¼ˆç« èŠ‚ + ç›¸ä¼¼åº¦ + å†…å®¹ç‰‡æ®µï¼‰
- âœ… æ³¨å…¥ Style Guide å¼•å¯¼ç”Ÿæˆé£æ ¼
- âœ… é™åˆ¶è¯æ®é•¿åº¦ï¼ˆ200å­—ç¬¦/ç‰‡æ®µï¼‰é¿å…ä¸Šä¸‹æ–‡æº¢å‡º

**ä¸è¶³ï¼š**

- âš ï¸ å›ºå®šçš„è¯æ®æ ¼å¼ï¼Œæœªæ ¹æ®ä»»åŠ¡ç±»å‹è°ƒæ•´
- âš ï¸ æœªå®ç°è¯æ®å»é‡å’Œå‹ç¼©

---

## ğŸ—ï¸ äºŒã€å·¥ç¨‹å®ç°è¯„ä¼°

### âœ… 2.1 ä»£ç è´¨é‡ (8/10)

**ä¼˜ç‚¹ï¼š**

- âœ… **TypeScript ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„æ¥å£å®šä¹‰
- âœ… **å•ä¸€èŒè´£åŸåˆ™**ï¼š`QwenRAGService` ç±»å°è£…æ¸…æ™°
- âœ… **é”™è¯¯å¤„ç†**ï¼štry-catch + é™çº§ç­–ç•¥
- âœ… **æ—¥å¿—è¾“å‡º**ï¼šè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯

```typescript
// ç±»å‹å®šä¹‰æ¸…æ™°
interface Chunk {
  id: string;
  content: string;
  embedding: number[];
  metadata: { chapter: string; level: number; position: number };
}
```

**ä¸è¶³ï¼š**

- âš ï¸ ç¼ºå°‘å•å…ƒæµ‹è¯•
- âš ï¸ éƒ¨åˆ†é­”æ³•æ•°å­—æœªæå–ä¸ºå¸¸é‡ï¼ˆå¦‚ 200ã€800ã€0.2ï¼‰

---

### âœ… 2.2 æ€§èƒ½ä¼˜åŒ– (7/10)

**ä¼˜ç‚¹ï¼š**

- âœ… **æ‰¹é‡ Embedding**ï¼šå‡å°‘ API è°ƒç”¨æ¬¡æ•°
- âœ… **ç¼“å­˜æœºåˆ¶**ï¼š`embeddingCache` é¿å…é‡å¤è®¡ç®—
- âœ… **åˆ†å—å¤§å°æ§åˆ¶**ï¼šé˜²æ­¢å•ä¸ªå—è¿‡å¤§ï¼ˆ800å­—ç¬¦ï¼‰

**ä¸è¶³ï¼š**

- âš ï¸ æœªå®ç° Web Worker å¼‚æ­¥å¤„ç†ï¼ˆå¤§æ–‡æ¡£ç´¢å¼•ä¼šé˜»å¡ UIï¼‰
- âš ï¸ ç¼ºå°‘ç´¢å¼•å‹ç¼©ï¼ˆå‘é‡ç»´åº¦å¯èƒ½å¾ˆé«˜ï¼‰
- âš ï¸ æœªä½¿ç”¨ IndexedDB å­˜å‚¨å¤§é‡æ•°æ®

---

### âœ… 2.3 ç”¨æˆ·ä½“éªŒ (8.5/10)

**ä¼˜ç‚¹ï¼š**

- âœ… **å¯è§†åŒ–åé¦ˆ**ï¼š
  - ç´¢å¼•æ„å»ºè¿›åº¦æç¤º
  - RAG çŠ¶æ€ Badge æ˜¾ç¤º
  - ç»Ÿè®¡ä¿¡æ¯é¢æ¿

```typescript
// src/pages/editor/draft.tsx#296-310
{ragReady && (
  <Badge count={ragStats?.totalChunks || 0}>
    <Button type="primary" onClick={handleRAGComplete}>
      RAGæ™ºèƒ½è¡¥å…¨
    </Button>
  </Badge>
)}
```

- âœ… **æ™ºèƒ½æç¤º**ï¼šé•¿æ–‡æ¡£è‡ªåŠ¨æç¤ºæ„å»º RAG
- âœ… **æµ‹è¯•å·¥å…·**ï¼šå†…ç½®æµ‹è¯•æ–‡æ¡£åŠ è½½å™¨

**ä¸è¶³ï¼š**

- âš ï¸ ç¼ºå°‘ç´¢å¼•æ„å»ºå¤±è´¥çš„è¯¦ç»†é”™è¯¯æç¤º
- âš ï¸ æœªæä¾›ç´¢å¼•ç®¡ç†ç•Œé¢ï¼ˆæŸ¥çœ‹/åˆ é™¤/å¯¼å‡ºï¼‰

---

### âœ… 2.4 åç«¯é›†æˆ (7/10)

**ä¼˜ç‚¹ï¼š**

- âœ… **ä»£ç†æœåŠ¡å™¨**ï¼š`server/server.js` å¤„ç† API è°ƒç”¨
- âœ… **ç¯å¢ƒå˜é‡ç®¡ç†**ï¼šAPI Key å®‰å…¨å­˜å‚¨
- âœ… **é”™è¯¯å¤„ç†**ï¼šå®Œæ•´çš„å“åº”çŠ¶æ€ç å¤„ç†

```javascript
// server/server.js#19-98
app.post('/api/embedding', async (req, res) => {
  const { texts } = req.body;
  // è°ƒç”¨é€šä¹‰åƒé—® Embedding API
  const response = await fetch('https://dashscope.aliyuncs.com/...');
  res.json(data);
});
```

**ä¸è¶³ï¼š**

- âš ï¸ ç¼ºå°‘è¯·æ±‚é™æµå’Œé‡è¯•æœºåˆ¶
- âš ï¸ æœªå®ç° API è°ƒç”¨ç›‘æ§å’Œæ—¥å¿—è®°å½•
- âš ï¸ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆä¸æ˜ç¡®

---

## ğŸ“ ä¸‰ã€å‰ç«¯é¢è¯•è§†è§’è¯„ä¼°

### âœ… 3.1 æŠ€æœ¯äº®ç‚¹ (é€‚åˆé¢è¯•å±•ç¤º)

**1. RAG æ ¸å¿ƒæ¦‚å¿µç†è§£ (9/10)**

- âœ… æ¸…æ™°å±•ç¤º Retrieval â†’ Augmentation â†’ Generation æµç¨‹
- âœ… ç†è§£å‘é‡æ£€ç´¢å’Œè¯­ä¹‰ç›¸ä¼¼åº¦
- âœ… æŒæ¡ Prompt Engineeringï¼ˆStyle Guide æ³¨å…¥ï¼‰

**2. å‰ç«¯å·¥ç¨‹èƒ½åŠ› (8/10)**

- âœ… TypeScript ç±»å‹ç³»ç»Ÿè¿ç”¨
- âœ… React Hooks çŠ¶æ€ç®¡ç†
- âœ… å¼‚æ­¥ç¼–ç¨‹å’Œé”™è¯¯å¤„ç†
- âœ… æ€§èƒ½ä¼˜åŒ–æ„è¯†ï¼ˆæ‰¹é‡å¤„ç†ã€ç¼“å­˜ï¼‰

**3. å…¨æ ˆè§†é‡ (7.5/10)**

- âœ… å‰åç«¯åˆ†ç¦»æ¶æ„
- âœ… API è®¾è®¡å’Œé›†æˆ
- âœ… ç¯å¢ƒå˜é‡å’Œå®‰å…¨æ€§è€ƒè™‘

**4. ç”¨æˆ·ä½“éªŒè®¾è®¡ (8/10)**

- âœ… æ¸è¿›å¼åŠŸèƒ½å¢å¼ºï¼ˆå¯é€‰å¼€å¯ RAGï¼‰
- âœ… å®æ—¶åé¦ˆå’ŒåŠ è½½çŠ¶æ€
- âœ… é™çº§ç­–ç•¥ï¼ˆRAG å¤±è´¥å›é€€åˆ°æ™®é€šè¡¥å…¨ï¼‰

---

### âœ… 3.2 å¯æ”¹è¿›ç‚¹ (é¢è¯•åŠ åˆ†é¡¹)

**1. æ¶æ„å±‚é¢ï¼š**

- ğŸ”§ å®ç°ç´¢å¼•æŒä¹…åŒ–ï¼ˆIndexedDB + äº‘ç«¯åŒæ­¥ï¼‰
- ğŸ”§ å¢é‡æ›´æ–°æœºåˆ¶ï¼ˆæ–‡æ¡£ä¿®æ”¹æ—¶åªæ›´æ–°å˜åŒ–éƒ¨åˆ†ï¼‰
- ğŸ”§ å¤šæ–‡æ¡£è”åˆæ£€ç´¢ï¼ˆè·¨é¡¹ç›®çŸ¥è¯†åº“ï¼‰

**2. ç®—æ³•å±‚é¢ï¼š**

- ğŸ”§ æ··åˆæ£€ç´¢ï¼ˆBM25 + å‘é‡æ£€ç´¢ï¼‰
- ğŸ”§ é‡æ’åºæ¨¡å‹ï¼ˆRerankerï¼‰
- ğŸ”§ åŠ¨æ€ Top-K é€‰æ‹©ï¼ˆæ ¹æ®æŸ¥è¯¢å¤æ‚åº¦è°ƒæ•´ï¼‰

**3. å·¥ç¨‹å±‚é¢ï¼š**

- ğŸ”§ Web Worker å¼‚æ­¥ç´¢å¼•æ„å»º
- ğŸ”§ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- ğŸ”§ æ€§èƒ½ç›‘æ§å’ŒåŸ‹ç‚¹

**4. äº§å“å±‚é¢ï¼š**

- ğŸ”§ ç´¢å¼•ç®¡ç†ç•Œé¢ï¼ˆå¯è§†åŒ–ã€å¯¼å…¥/å¯¼å‡ºï¼‰
- ğŸ”§ ç”¨æˆ·åé¦ˆæœºåˆ¶ï¼ˆç‚¹èµ/ç‚¹è¸©æ”¹è¿›æ£€ç´¢è´¨é‡ï¼‰
- ğŸ”§ A/B æµ‹è¯•æ¡†æ¶ï¼ˆå¯¹æ¯” RAG æ•ˆæœï¼‰

---

## ğŸ“ å››ã€é¢è¯•é—®ç­”å‡†å¤‡

### Q1: ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ç§åˆ†å—ç­–ç•¥ï¼Ÿ

**A:** åŸºäº Markdown æ ‡é¢˜åˆ†å—å¯ä»¥ï¼š

1. ä¿æŒè¯­ä¹‰å®Œæ•´æ€§ï¼ˆä¸ä¼šæˆªæ–­æ®µè½ï¼‰
2. ä¿ç•™æ–‡æ¡£ç»“æ„ä¿¡æ¯ï¼ˆç« èŠ‚ã€å±‚çº§ï¼‰
3. ä¾¿äºç”¨æˆ·ç†è§£æ£€ç´¢æ¥æº
4. æ§åˆ¶å—å¤§å°ï¼ˆ800å­—ç¬¦ä¸Šé™ï¼‰é¿å…ä¸Šä¸‹æ–‡æº¢å‡º

### Q2: å¦‚ä½•å¤„ç†å¤§æ–‡æ¡£çš„æ€§èƒ½é—®é¢˜ï¼Ÿ

**A:** é‡‡ç”¨äº†å¤šç§ä¼˜åŒ–ç­–ç•¥ï¼š

1. **æ‰¹é‡ Embedding**ï¼šæ¯æ¬¡å¤„ç† 10 ä¸ªå—ï¼Œå‡å°‘ API è°ƒç”¨
2. **ç¼“å­˜æœºåˆ¶**ï¼šembedding ç»“æœç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—
3. **å¼‚æ­¥å¤„ç†**ï¼šä½¿ç”¨ async/await é¿å…é˜»å¡ UI
4. **é™çº§ç­–ç•¥**ï¼šç´¢å¼•æ„å»ºå¤±è´¥æ—¶å›é€€åˆ°æ™®é€šè¡¥å…¨

### Q3: å¦‚ä½•ä¿è¯æ£€ç´¢è´¨é‡ï¼Ÿ

**A:** å¤šå±‚è¿‡æ»¤å’Œæ’åºï¼š

1. **æœ€å°ç›¸ä¼¼åº¦é˜ˆå€¼**ï¼ˆ0.2ï¼‰è¿‡æ»¤ä½è´¨é‡ç»“æœ
2. **Top-K æ’åº**è¿”å›æœ€ç›¸å…³çš„ 3 ä¸ªç‰‡æ®µ
3. **å…ƒæ•°æ®å±•ç¤º**ï¼ˆç« èŠ‚ã€ç›¸ä¼¼åº¦ï¼‰å¸®åŠ©ç”¨æˆ·åˆ¤æ–­
4. **å†å²æ£€ç´¢**è¡¥å……å½“å‰æ–‡æ¡£å¤–çš„çŸ¥è¯†

### Q4: å¦‚ä½•é€‚é…ä¸åŒç±»å‹çš„æ–‡æ¡£ï¼Ÿ

**A:** å®ç°äº†æ–‡æ¡£ç±»å‹æ£€æµ‹ï¼š

1. **ä»£ç æ–‡æ¡£**ï¼šä½ temperature (0.2)ï¼Œç²¾ç¡®è¡¥å…¨
2. **æŠ€æœ¯æ–‡æ¡£**ï¼šä¸­ç­‰ temperature (0.3)ï¼Œç®€æ´ä¸“ä¸š
3. **æ–‡å­¦æ–‡æœ¬**ï¼šé«˜ temperature (0.8)ï¼Œè‡ªç„¶æµç•…
4. **åŠ¨æ€ Style Guide**ï¼šæ³¨å…¥ä¸åŒçš„ç”ŸæˆæŒ‡ä»¤

### Q5: ä¸Šä¸‹æ–‡æ„ŸçŸ¥ä½“ç°åœ¨å“ªäº›æ–¹é¢ï¼Ÿ

**A:** å¤šç»´åº¦ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼š

1. **ä½ç½®ä¸Šä¸‹æ–‡**ï¼šç»“åˆå…‰æ ‡å‰åæ–‡æœ¬æ„å»ºæŸ¥è¯¢
2. **æ–‡æ¡£ç»“æ„ä¸Šä¸‹æ–‡**ï¼šä¿ç•™ç« èŠ‚ã€å±‚çº§ä¿¡æ¯
3. **å†å²ä¸Šä¸‹æ–‡**ï¼šè·¨æ–‡æ¡£æ£€ç´¢å†å²å†…å®¹
4. **ç±»å‹ä¸Šä¸‹æ–‡**ï¼šæ ¹æ®æ–‡æ¡£ç±»å‹è°ƒæ•´ç­–ç•¥

---

## ğŸš€ äº”ã€ä¼˜åŒ–å»ºè®®ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰

### ğŸ”¥ é«˜ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

**1. ç´¢å¼•æŒä¹…åŒ– (é‡è¦æ€§: â­â­â­â­â­)**

```typescript
// å»ºè®®å®ç°æ–¹æ¡ˆ
class PersistentRAGService extends QwenRAGService {
  async saveIndex() {
    const db = await openDB('rag-index', 1);
    await db.put('indexes', {
      id: this.docId,
      chunks: this.chunks,
      timestamp: Date.now(),
    });
  }

  async loadIndex(docId: string) {
    const db = await openDB('rag-index', 1);
    const data = await db.get('indexes', docId);
    this.chunks = data.chunks;
  }
}
```

**æ”¶ç›Šï¼š**

- âœ… é¿å…åˆ·æ–°é¡µé¢åé‡å»ºç´¢å¼•
- âœ… æ”¯æŒç¦»çº¿ä½¿ç”¨
- âœ… æå‡ç”¨æˆ·ä½“éªŒ

---

**2. å¢é‡æ›´æ–°æœºåˆ¶ (é‡è¦æ€§: â­â­â­â­)**

```typescript
// å»ºè®®å®ç°æ–¹æ¡ˆ
async updateIndex(changes: { added: string[], removed: string[], modified: string[] }) {
  // åªå¤„ç†å˜åŒ–çš„éƒ¨åˆ†
  const newChunks = this.semanticChunk(changes.added.join('\n'));
  const newEmbeddings = await this.batchGetEmbeddings(newChunks.map(c => c.content));

  // ç§»é™¤æ—§å—
  this.chunks = this.chunks.filter(c => !changes.removed.includes(c.id));

  // æ·»åŠ æ–°å—
  this.chunks.push(...newChunks.map((c, i) => ({
    ...c,
    embedding: newEmbeddings[i]
  })));
}
```

**æ”¶ç›Šï¼š**

- âœ… å¤§å¹…å‡å°‘é‡å»ºæ—¶é—´
- âœ… èŠ‚çœ API è°ƒç”¨æˆæœ¬
- âœ… å®æ—¶æ›´æ–°ç´¢å¼•

---

**3. æ··åˆæ£€ç´¢ (é‡è¦æ€§: â­â­â­â­)**

```typescript
// å»ºè®®å®ç°æ–¹æ¡ˆ
async hybridSearch(query: string, topK: number) {
  // 1. å‘é‡æ£€ç´¢
  const vectorResults = await this.vectorSearch(query, topK * 2);

  // 2. å…³é”®è¯æ£€ç´¢ï¼ˆBM25ï¼‰
  const keywordResults = this.bm25Search(query, topK * 2);

  // 3. èåˆæ’åºï¼ˆRRF - Reciprocal Rank Fusionï¼‰
  const merged = this.reciprocalRankFusion([vectorResults, keywordResults]);

  return merged.slice(0, topK);
}
```

**æ”¶ç›Šï¼š**

- âœ… æå‡æ£€ç´¢å¬å›ç‡
- âœ… å¤„ç†ç²¾ç¡®åŒ¹é…éœ€æ±‚ï¼ˆå¦‚ä»£ç ç¬¦å·ï¼‰
- âœ… æ›´é²æ£’çš„æ£€ç´¢æ•ˆæœ

---

### âš¡ ä¸­ä¼˜å…ˆçº§ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

**4. Web Worker å¼‚æ­¥å¤„ç† (é‡è¦æ€§: â­â­â­)**

```typescript
// rag-worker.ts
self.onmessage = async (e) => {
  const { type, data } = e.data;

  if (type === 'buildIndex') {
    const chunks = semanticChunk(data.markdown);
    const embeddings = await batchGetEmbeddings(chunks);
    self.postMessage({ type: 'indexReady', chunks, embeddings });
  }
};

// ä¸»çº¿ç¨‹
const worker = new Worker('rag-worker.ts');
worker.postMessage({ type: 'buildIndex', data: { markdown } });
```

**æ”¶ç›Šï¼š**

- âœ… é¿å…é˜»å¡ UI çº¿ç¨‹
- âœ… æå‡å¤§æ–‡æ¡£å¤„ç†æ€§èƒ½
- âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

---

**5. æ™ºèƒ½ç¼“å­˜ç­–ç•¥ (é‡è¦æ€§: â­â­â­)**

```typescript
// å»ºè®®å®ç°æ–¹æ¡ˆ
class SmartCache {
  private cache = new Map<string, { embedding: number[]; timestamp: number; hits: number }>();
  private maxSize = 1000;

  set(key: string, value: number[]) {
    // LRU + çƒ­åº¦æ·˜æ±°ç­–ç•¥
    if (this.cache.size >= this.maxSize) {
      const leastUsed = [...this.cache.entries()].sort(
        (a, b) => a[1].hits - b[1].hits || a[1].timestamp - b[1].timestamp,
      )[0];
      this.cache.delete(leastUsed[0]);
    }
    this.cache.set(key, { embedding: value, timestamp: Date.now(), hits: 0 });
  }

  get(key: string) {
    const item = this.cache.get(key);
    if (item) {
      item.hits++;
      return item.embedding;
    }
    return null;
  }
}
```

**æ”¶ç›Šï¼š**

- âœ… å‡å°‘å†…å­˜å ç”¨
- âœ… æå‡ç¼“å­˜å‘½ä¸­ç‡
- âœ… è‡ªåŠ¨æ·˜æ±°å†·æ•°æ®

---

### ğŸ’¡ ä½ä¼˜å…ˆçº§ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰

**6. é‡æ’åºæ¨¡å‹ (é‡è¦æ€§: â­â­)**

```typescript
// å»ºè®®å®ç°æ–¹æ¡ˆ
async rerank(query: string, candidates: SearchResult[]) {
  // ä½¿ç”¨äº¤å‰ç¼–ç å™¨é‡æ–°æ‰“åˆ†
  const scores = await this.crossEncoderScore(query, candidates.map(c => c.content));

  return candidates
    .map((c, i) => ({ ...c, rerankScore: scores[i] }))
    .sort((a, b) => b.rerankScore - a.rerankScore);
}
```

**æ”¶ç›Šï¼š**

- âœ… æå‡æ£€ç´¢ç²¾åº¦
- âœ… æ›´å‡†ç¡®çš„ç›¸å…³æ€§åˆ¤æ–­

---

**7. å¤šæ ·æ€§æ§åˆ¶ (é‡è¦æ€§: â­â­)**

```typescript
// å»ºè®®å®ç°æ–¹æ¡ˆ
diversifyResults(results: SearchResult[], threshold = 0.8) {
  const diverse: SearchResult[] = [results[0]];

  for (const candidate of results.slice(1)) {
    const maxSim = Math.max(...diverse.map(d =>
      this.cosineSimilarity(candidate.embedding, d.embedding)
    ));

    if (maxSim < threshold) {
      diverse.push(candidate);
    }
  }

  return diverse;
}
```

**æ”¶ç›Šï¼š**

- âœ… é¿å…è¿”å›é‡å¤å†…å®¹
- âœ… æä¾›æ›´å…¨é¢çš„ä¸Šä¸‹æ–‡

---

## ğŸ“Š å…­ã€æ€§èƒ½åŸºå‡†æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯è®¾è®¡

**1. ç´¢å¼•æ„å»ºæ€§èƒ½**

```typescript
// æµ‹è¯•ä¸åŒæ–‡æ¡£å¤§å°çš„æ„å»ºæ—¶é—´
const benchmarks = [
  { size: '3Kå­—', expected: '<2s' },
  { size: '1ä¸‡å­—', expected: '<5s' },
  { size: '5ä¸‡å­—', expected: '<20s' },
];
```

**2. æ£€ç´¢æ€§èƒ½**

```typescript
// æµ‹è¯•ä¸åŒç´¢å¼•è§„æ¨¡çš„æ£€ç´¢æ—¶é—´
const searchBenchmarks = [
  { chunks: 50, expected: '<100ms' },
  { chunks: 200, expected: '<300ms' },
  { chunks: 1000, expected: '<1s' },
];
```

**3. å†…å­˜å ç”¨**

```typescript
// ç›‘æ§å†…å­˜ä½¿ç”¨
const memoryBenchmarks = [
  { chunks: 100, expected: '<10MB' },
  { chunks: 500, expected: '<50MB' },
  { chunks: 1000, expected: '<100MB' },
];
```

---

## ğŸ¯ ä¸ƒã€æ€»ç»“ä¸å»ºè®®

### âœ… ä¼˜åŠ¿æ€»ç»“

**1. é¡¹ç›®çº§å®Œæ•´åº¦é«˜**

- å®Œæ•´çš„ RAG å®ç°æµç¨‹
- è‰¯å¥½çš„ä»£ç ç»„ç»‡å’Œç±»å‹å®‰å…¨
- ç”¨æˆ·ä½“éªŒè€ƒè™‘å‘¨åˆ°

**2. ä¸Šä¸‹æ–‡æ„ŸçŸ¥å¤šç»´åº¦**

- æ–‡æ¡£ç±»å‹æ„ŸçŸ¥
- ä½ç½®ä¸Šä¸‹æ–‡æ„ŸçŸ¥
- å†å²ä¸Šä¸‹æ–‡æ„ŸçŸ¥
- å…ƒæ•°æ®ä¸Šä¸‹æ–‡ä¿ç•™

**3. å·¥ç¨‹å®è·µæ‰å®**

- æ‰¹é‡å¤„ç†ä¼˜åŒ–
- ç¼“å­˜æœºåˆ¶
- é”™è¯¯å¤„ç†å’Œé™çº§
- å¯è§†åŒ–åé¦ˆ

### ğŸ“ é¢è¯•å±•ç¤ºå»ºè®®

**1. å‡†å¤‡ Demo æ¼”ç¤º**

- åŠ è½½æµ‹è¯•æ–‡æ¡£ï¼ˆå±•ç¤ºä¸åŒè§„æ¨¡ï¼‰
- æ„å»º RAG ç´¢å¼•ï¼ˆå±•ç¤ºè¿›åº¦åé¦ˆï¼‰
- æ™ºèƒ½è¡¥å…¨å¯¹æ¯”ï¼ˆæœ‰ RAG vs æ—  RAGï¼‰
- ç»Ÿè®¡ä¿¡æ¯å±•ç¤º

**2. è®²è§£æŠ€æœ¯è¦ç‚¹**

- RAG æ ¸å¿ƒåŸç†ï¼ˆ3 åˆ†é’Ÿï¼‰
- ä¸Šä¸‹æ–‡æ„ŸçŸ¥ç­–ç•¥ï¼ˆ5 åˆ†é’Ÿï¼‰
- æ€§èƒ½ä¼˜åŒ–æªæ–½ï¼ˆ3 åˆ†é’Ÿï¼‰
- å·¥ç¨‹å®è·µç»éªŒï¼ˆ4 åˆ†é’Ÿï¼‰

**3. å‡†å¤‡æ‰©å±•è¯é¢˜**

- å¦‚ä½•å¤„ç†å¤šæ¨¡æ€å†…å®¹ï¼ˆå›¾ç‰‡ã€è¡¨æ ¼ï¼‰
- å¦‚ä½•å®ç°è·¨è¯­è¨€æ£€ç´¢
- å¦‚ä½•è¯„ä¼° RAG æ•ˆæœ
- å¦‚ä½•å¤„ç†éšç§å’Œå®‰å…¨é—®é¢˜

### ğŸ“ˆ æ”¹è¿›è·¯çº¿å›¾

**çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰ï¼š**

1. âœ… å®ç°ç´¢å¼•æŒä¹…åŒ–ï¼ˆIndexedDBï¼‰
2. âœ… æ·»åŠ å•å…ƒæµ‹è¯•è¦†ç›–
3. âœ… æå–é­”æ³•æ•°å­—ä¸ºé…ç½®å¸¸é‡

**ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰ï¼š**

1. âœ… å®ç°å¢é‡æ›´æ–°æœºåˆ¶
2. âœ… æ·»åŠ æ··åˆæ£€ç´¢
3. âœ… Web Worker å¼‚æ­¥å¤„ç†

**é•¿æœŸï¼ˆ2-3ä¸ªæœˆï¼‰ï¼š**

1. âœ… å®ç°é‡æ’åºæ¨¡å‹
2. âœ… å¤šæ–‡æ¡£è”åˆæ£€ç´¢
3. âœ… å®Œå–„ç›‘æ§å’Œåˆ†æç³»ç»Ÿ

---

## ğŸ† æœ€ç»ˆè¯„ä»·

**é¡¹ç›®çº§åˆ«ï¼š** â­â­â­â­ (4/5æ˜Ÿ)

**é€‚åˆåœºæ™¯ï¼š**

- âœ… å‰ç«¯é«˜çº§å·¥ç¨‹å¸ˆé¢è¯•
- âœ… å…¨æ ˆå·¥ç¨‹å¸ˆé¢è¯•
- âœ… AI åº”ç”¨å¼€å‘å²—ä½
- âœ… æŠ€æœ¯åˆ†äº«å’Œæ¼”è®²

**æ ¸å¿ƒç«äº‰åŠ›ï¼š**

1. **å®Œæ•´çš„ RAG å®ç°**ï¼šä»ç´¢å¼•åˆ°æ£€ç´¢åˆ°ç”Ÿæˆçš„å…¨é“¾è·¯
2. **å¤šç»´åº¦ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šæ–‡æ¡£ç±»å‹ã€ä½ç½®ã€å†å²ã€å…ƒæ•°æ®
3. **å·¥ç¨‹å®è·µæ‰å®**ï¼šæ€§èƒ½ä¼˜åŒ–ã€é”™è¯¯å¤„ç†ã€ç”¨æˆ·ä½“éªŒ
4. **å¯æ‰©å±•æ€§å¼º**ï¼šæ¸…æ™°çš„æ¶æ„è®¾è®¡ï¼Œæ˜“äºè¿­ä»£

**å»ºè®®é‡ç‚¹å¼ºè°ƒï¼š**

- RAG æ ¸å¿ƒåŸç†çš„æ·±å…¥ç†è§£
- ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„å¤šç»´åº¦è®¾è®¡
- æ€§èƒ½ä¼˜åŒ–çš„å®è·µç»éªŒ
- ç”¨æˆ·ä½“éªŒçš„ç»†èŠ‚æ‰“ç£¨

---

**è¯„ä¼°å®Œæˆæ—¶é—´ï¼š** 2025-11-19
**è¯„ä¼°äººï¼š** Cascade AI
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
